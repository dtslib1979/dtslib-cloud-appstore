<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="클립 선택만으로 3분 쇼츠 자동 생성">
    <meta name="theme-color" content="#e91e63">
    <title>Clip Shorts - 클립 조합 쇼츠 메이커</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Clip Shorts</h1>
            <p class="subtitle">클립 선택 → 3분 쇼츠 자동 생성</p>
            <p class="version" id="appVersion">v--</p>
        </header>

        <div class="memory-warning" id="memWarn" style="display: none;"></div>

        <main>
            <!-- Step 1: Clip Duration -->
            <section class="step-card">
                <div class="step-header">
                    <span class="step-num">1</span>
                    <span class="step-title">클립 길이 선택</span>
                </div>
                <div class="duration-buttons">
                    <button id="btn10s" class="duration-btn active" onclick="setClipDuration(10)">
                        <span class="dur-value">10초</span>
                        <span class="dur-info">최대 18개</span>
                    </button>
                    <button id="btn15s" class="duration-btn" onclick="setClipDuration(15)">
                        <span class="dur-value">15초</span>
                        <span class="dur-info">최대 12개</span>
                    </button>
                </div>
            </section>

            <!-- Step 2: Upload Clips -->
            <section class="step-card">
                <div class="step-header">
                    <span class="step-num">2</span>
                    <span class="step-title">클립 업로드</span>
                </div>
                <div class="file-drop-zone" id="clipDropZone"
                     onclick="document.getElementById('clipInput').click()"
                     ondragover="handleDragOver(event)"
                     ondragleave="handleDragLeave(event)"
                     ondrop="handleDrop(event)">
                    <input type="file" id="clipInput" accept="video/*" multiple hidden>
                    <div class="drop-content">
                        <span class="drop-icon">📹</span>
                        <span class="drop-text">클릭 또는 드래그하여 클립 추가</span>
                        <span class="drop-hint">여러 파일 선택 가능 (MP4, MOV)</span>
                    </div>
                </div>

                <div id="clipList" class="clip-list"></div>

                <div id="clipSummary" class="clip-summary" style="display: none;">
                    <span id="clipCount">0개</span> 클립 ·
                    <span id="totalDuration">0분 0초</span>
                </div>
            </section>

            <!-- Step 3: Effects -->
            <section class="step-card">
                <div class="step-header">
                    <span class="step-num">3</span>
                    <span class="step-title">효과 설정</span>
                </div>

                <!-- Intro Effect -->
                <div class="effect-section">
                    <p class="effect-label">🎬 시작 효과 (페이드 인)</p>
                    <div class="effect-buttons" id="introEffects">
                        <button class="effect-btn active" onclick="setIntro('none')" data-effect="none">
                            <span class="effect-icon">⊘</span>
                            <span class="effect-name">없음</span>
                        </button>
                        <button class="effect-btn" onclick="setIntro('tv')" data-effect="tv">
                            <span class="effect-icon">📺</span>
                            <span class="effect-name">TV</span>
                        </button>
                        <button class="effect-btn" onclick="setIntro('vhs')" data-effect="vhs">
                            <span class="effect-icon">📼</span>
                            <span class="effect-name">VHS</span>
                        </button>
                        <button class="effect-btn" onclick="setIntro('focus')" data-effect="focus">
                            <span class="effect-icon">🎯</span>
                            <span class="effect-name">FOCUS</span>
                        </button>
                        <button class="effect-btn" onclick="setIntro('tremble')" data-effect="tremble">
                            <span class="effect-icon">📳</span>
                            <span class="effect-name">TREMBLE</span>
                        </button>
                        <button class="effect-btn" onclick="setIntro('zoom')" data-effect="zoom">
                            <span class="effect-icon">🔍</span>
                            <span class="effect-name">ZOOM</span>
                        </button>
                    </div>
                </div>

                <!-- Middle Transition -->
                <div class="effect-section">
                    <p class="effect-label">🔗 중간 트랜지션 (클립 사이)</p>
                    <div class="effect-buttons" id="transitionEffects">
                        <button class="effect-btn active" onclick="setTransition('none')" data-effect="none">
                            <span class="effect-icon">⊘</span>
                            <span class="effect-name">없음</span>
                        </button>
                        <button class="effect-btn" onclick="setTransition('tv')" data-effect="tv">
                            <span class="effect-icon">📺</span>
                            <span class="effect-name">TV</span>
                        </button>
                        <button class="effect-btn" onclick="setTransition('vhs')" data-effect="vhs">
                            <span class="effect-icon">📼</span>
                            <span class="effect-name">VHS</span>
                        </button>
                        <button class="effect-btn" onclick="setTransition('focus')" data-effect="focus">
                            <span class="effect-icon">🎯</span>
                            <span class="effect-name">FOCUS</span>
                        </button>
                        <button class="effect-btn" onclick="setTransition('tremble')" data-effect="tremble">
                            <span class="effect-icon">📳</span>
                            <span class="effect-name">TREMBLE</span>
                        </button>
                        <button class="effect-btn" onclick="setTransition('zoom')" data-effect="zoom">
                            <span class="effect-icon">🔍</span>
                            <span class="effect-name">ZOOM</span>
                        </button>
                    </div>
                </div>

                <!-- Ending Effect -->
                <div class="effect-section">
                    <p class="effect-label">🎬 엔딩 효과 (페이드 아웃)</p>
                    <div class="effect-buttons" id="endingEffects">
                        <button class="effect-btn active" onclick="setEnding('none')" data-effect="none">
                            <span class="effect-icon">⊘</span>
                            <span class="effect-name">없음</span>
                        </button>
                        <button class="effect-btn" onclick="setEnding('tv')" data-effect="tv">
                            <span class="effect-icon">📺</span>
                            <span class="effect-name">TV</span>
                        </button>
                        <button class="effect-btn" onclick="setEnding('vhs')" data-effect="vhs">
                            <span class="effect-icon">📼</span>
                            <span class="effect-name">VHS</span>
                        </button>
                        <button class="effect-btn" onclick="setEnding('focus')" data-effect="focus">
                            <span class="effect-icon">🎯</span>
                            <span class="effect-name">FOCUS</span>
                        </button>
                        <button class="effect-btn" onclick="setEnding('tremble')" data-effect="tremble">
                            <span class="effect-icon">📳</span>
                            <span class="effect-name">TREMBLE</span>
                        </button>
                        <button class="effect-btn" onclick="setEnding('zoom')" data-effect="zoom">
                            <span class="effect-icon">🔍</span>
                            <span class="effect-name">ZOOM</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Step 4: Volume Normalization -->
            <section class="step-card">
                <div class="step-header">
                    <span class="step-num">4</span>
                    <span class="step-title">볼륨 평준화</span>
                </div>
                <p class="step-desc">모든 클립의 음량을 균일하게 조정</p>
                <div class="toggle-container">
                    <label class="toggle">
                        <input type="checkbox" id="normalizeToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">음량 평준화 (-16 LUFS)</span>
                </div>
            </section>

            <!-- Step 5: Background Music -->
            <section class="step-card">
                <div class="step-header">
                    <span class="step-num">5</span>
                    <span class="step-title">배경 음악</span>
                </div>
                <p class="step-desc">배경 음악을 추가하고 볼륨을 조절하세요</p>

                <div class="toggle-container">
                    <label class="toggle">
                        <input type="checkbox" id="bgmToggle">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">배경 음악 사용</span>
                </div>

                <div id="bgmControls" class="bgm-controls" style="display: none;">
                    <!-- BGM Upload -->
                    <div class="bgm-upload-section">
                        <div class="file-drop-zone bgm-drop" id="bgmDropZone"
                             onclick="document.getElementById('bgmInput').click()"
                             ondragover="handleBGMDragOver(event)"
                             ondragleave="handleDragLeave(event)"
                             ondrop="handleBGMDrop(event)">
                            <input type="file" id="bgmInput" accept="audio/*" hidden>
                            <div class="drop-content">
                                <span class="drop-icon">🎵</span>
                                <span class="drop-text">음악 파일 선택</span>
                                <span class="drop-hint">MP3, WAV, M4A 등</span>
                            </div>
                        </div>

                        <!-- BGM Info -->
                        <div id="bgmInfo" class="bgm-info" style="display: none;">
                            <div class="bgm-file-info">
                                <span class="bgm-icon">🎵</span>
                                <span id="bgmFileName" class="bgm-name">파일명.mp3</span>
                            </div>
                            <div class="bgm-actions">
                                <button id="bgmPlayBtn" class="bgm-play-btn">▶️</button>
                                <button id="bgmRemoveBtn" class="bgm-remove-btn">✕</button>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden audio for preview -->
                    <audio id="bgmPreview" preload="metadata"></audio>

                    <!-- Volume Controls -->
                    <div class="volume-controls">
                        <div class="volume-row">
                            <span class="volume-label">🎵 BGM 볼륨</span>
                            <input type="range" id="bgmVolume" min="0" max="1" step="0.05" value="0.5" class="volume-slider">
                            <span id="bgmVolumeValue" class="volume-value">50%</span>
                        </div>
                        <div class="volume-row">
                            <span class="volume-label">🎬 원본 볼륨</span>
                            <input type="range" id="clipVolume" min="0" max="1" step="0.05" value="1" class="volume-slider">
                            <span id="clipVolumeValue" class="volume-value">100%</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 6: Generate -->
            <section class="step-card generate-card">
                <div class="step-header">
                    <span class="step-num">6</span>
                    <span class="step-title">쇼츠 생성</span>
                </div>

                <button id="genBtn" class="generate-btn" onclick="generate()" disabled>
                    <span class="btn-icon">🚀</span>
                    <span class="btn-text">3분 쇼츠 만들기</span>
                </button>
            </section>

            <!-- Progress -->
            <section id="progressSection" class="progress-section" style="display: none;">
                <div class="progress-header">
                    <span id="statusText" class="status">준비 중...</span>
                    <button onclick="abortProcessing()" class="abort-btn">⏹️ 중단</button>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <div class="progress-details">
                        <span id="progressText">0%</span>
                        <span id="etaText" class="eta"></span>
                    </div>
                </div>
                <div id="progressLog" class="progress-log"></div>
            </section>

            <!-- Result -->
            <section id="resultSection" class="result-section" style="display: none;">
                <div class="result-header">
                    <span class="result-icon">✅</span>
                    <span class="result-title">완료!</span>
                </div>
                <div id="resultStats" class="result-stats"></div>
                <video id="preview" controls playsinline class="preview-video"></video>
                <div class="result-actions">
                    <a id="downloadLink" class="action-btn download-btn" download>
                        💾 다운로드
                    </a>
                    <button onclick="reset()" class="action-btn reset-btn">
                        🔄 새로 만들기
                    </button>
                </div>
            </section>
        </main>

        <footer>
            <p>DTS Cloud AppStore</p>
        </footer>
    </div>

    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <script src="./app.js"></script>
</body>
</html>
